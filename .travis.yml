arch: s390x
services:
  - docker
  - postgresql
apt:
  packages:
    - postgresql-13
    - postgresql-client-13
addons:
  hosts:
    - travis.dev
env:
  global:
    - TEST_DIR="$PWD/test"
    - TEST_SCRIPT="test.sh"
    - BUILD_DIR="$PWD"
    - REPO="quay.io/ibmz/clair"
    - TAG="$REPO:2.0"
before_script: 
  - cd $TEST_DIR && chmod +x $TEST_SCRIPT
  - docker login quay.io -u $ROBOT -p $ROBOT_TOKEN
  - sudo /etc/init.d/postgresql start 13
  - psql -c "CREATE USER user WITH PASSWORD 'password';" -U postgres
script: 
  - docker build $BUILD_DIR --tag $TAG
  - cd $TEST_DIR && bash $TEST_SCRIPT 
after_script:
  - docker push $REPO
